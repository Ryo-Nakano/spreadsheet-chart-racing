# 開発ガイドライン (Development Guidelines)

## 1. はじめに (Introduction)

このドキュメントは、本プロジェクトにおけるコーディング規約、設計方針、および開発プロセスを定義するものです。
主な目的は以下の通りです。

-   コードの品質と一貫性を維持する。
-   人間とAI（例: Gemini）が協調して、効率的に開発を進めるための共通認識を確立する。
-   新しい開発者が迅速にプロジェクトの構造とルールを理解し、開発に参加できるようにする。

すべての開発参加者（AIを含む）は、このガイドラインに従う必要があります。

## 2. 開発の基本方針 (Core Principles)

-   **既存コードの再利用**: 新しい機能を実装する際は、まず`src/utils`や`src/sheet_data`に利用可能な既存の関数やクラスがないか確認してください。重複するロジックを作成するのではなく、既存の実装を積極的に再利用し、拡張する方針をとります。
-   **一貫性の重視**: 新しいコードは、既存のコードのスタイル、命名規則、設計パターンに厳密に従ってください。

## 3. コードの構造と設計方針 (Architecture & Design Patterns)

#### Operationクラスの責務
-   ユーザーの1つの操作（メニューの1項目など）は、原則として1つの`Operation`クラスに対応させます。
-   `Operation`クラスは必ず`base_classes/base_operation.js`の`BaseOperation`を継承してください。

#### `run()` と `_operation()` の使い分け
-   `run()`: エラーハンドリングや前処理・後処理など、操作全体を管理する公開メソッドです。このメソッドを直接変更することはありません。
-   `_operation()`: 個々の操作の具体的なロジックを実装する内部メソッドです。開発者は主にこちらを実装します。

#### データアクセス
-   スプレッドシートの特定のシートへのデータアクセスは、直接`SpreadsheetApp`を呼び出すのではなく、**必ず`src/sheet_data`内の対応するデータアクセスクラス（DAO）を経由して行ってください。** これにより、データの取得方法や構造の変更に柔軟に対応できます。

#### ユーティリティの利用
-   日付計算、シート操作、配列操作などの汎用的な処理は、**`src/utils`内のヘルパー関数を利用してください。**

#### グローバル関数の役割 (`index.js`)
-   Google Apps ScriptのUI（カスタムメニューなど）からのエントリーポイントとしてのみ使用します。
-   グローバル関数内では、対応する`Operation`クラスをインスタンス化し、`.run()`を呼び出す以上のロジックは含めないでください。

#### ディレクトリ構成
-   `src/operations`: ユーザー操作に直接対応する`Operation`クラスを配置します。
-   `src/sheet_data`: **(DAO)** 各シートへのアクセスクラスを配置します。
-   `src/utils`: プロジェクト全体で利用される共通処理を配置します。
-   `src/base_classes`: 継承元となる基底クラスを配置します。

## 4. 命名規則 (Naming Conventions)

-   **ファイル名**: `snake_case` （例: `convert_edi_data_operation.js`）
-   **クラス名**: `PascalCase` （例: `BaseOperation`, `ProductMasterData`）
-   **メソッド/関数名**: `camelCase` （例: `_createTabFunction`, `run`）
    -   クラス内部でのみ使用するメソッドは、先頭にアンダースコアを付けます (`_operation`)。
-   **変数名**: `camelCase` （例: `spreadsheet`）
-   **定数名**: `UPPER_SNAKE_CASE` （例: `SHEETS`, `ERROR_TYPES`）
-   **グローバル関数名**: `...Operation` で終わる `camelCase` （例: `convertEdiDataOperation`）

## 5. コーディングスタイル (Coding Style)

-   **定数の利用**: コード内でハードコーディングされた文字列や数値（マジックナンバー）を使用せず、原則として `src/constants.js` に定義された定数を参照してください。
-   **フォーマット**:
    -   インデント: スペース2つ
    -   セミコロン: 原則として文末に付ける
-   **コメント (JSDoc)**:
    -   **全ての新しいクラスと、外部から呼び出される可能性のあるメソッドには、その役割、引数 (`@param`)、返り値 (`@returns`) を説明するJSDoc形式のコメントを記述することを必須とします。**
    -   複雑なロジックや、なぜその実装にしたのかという「意図」を説明するためにコメントを記述します。何をしているかの自明な説明は不要です。
-   **GAS (Google Apps Script) 固有の注意点**:
    -   `SpreadsheetApp`などのGASグローバルオブジェクトへの直接アクセスは、パフォーマンスの観点からDAOやユーティリティ内に限定し、`Operation`クラス内での直接呼び出しは避けてください。

## 6. ユーザーインターフェース (UI/UX)

-   **メッセージの表現**: `SpreadsheetApp.getUi().alert()` などでユーザーに表示するメッセージは、専門用語を避け、簡潔で分かりやすい表現を用いるようにしてください。

## 7. エラーハンドリング (Error Handling)

-   ユーザーに起因するエラーや、処理の中断を伝える必要がある場合は、`SpreadsheetApp.getUi().alert()`でメッセージを表示します。
-   予期せぬ例外は`BaseOperation`の`run`メソッドで捕捉・記録されるため、個別の`_operation`内での網羅的な`try-catch`は原則不要です。

## 8. Git利用方針 (Git Workflow)

-   **コミットメッセージ**:
    -   **コミットメッセージは日本語で記述してください。**
    -   変更内容が明確にわかるように記述してください。
    -   プレフィックスの利用を推奨します: `feat:`, `fix:`, `refactor:`, `docs:`, `style:`
    -   例: `feat: エラー報告機能を追加`, `docs: DEVELOPMENT_GUIDELINES.md を作成`
-   **ブランチ戦略**:
    -   （プロジェクトで定義されていれば）`main`ブランチ、`develop`ブランチ、フィーチャーブランチなどの使い分けに従ってください。

### AI（Gemini）向けの特記事項

AIエージェントがコミットを実行する場合、上記に加えて以下のルールを**厳守**してください。

1.  **課題番号の自動挿入**:
    1.  `git branch --show-current` を実行し、現在のブランチ名を取得します (例: `feature-123`)。
    2.  ブランチ名から末尾の数字を抽出し (`123`)、コミットメッセージの**タイトルの末尾**に `#123` のように課題番号として付与します。
2.  **特定ファイルの除外**:
    -   `src/operations/test_operation.js` ファイルは、いかなる場合もコミットに含めないでください。
3.  **コミットメッセージの提案**:
    -   `git diff` の内容を基に、変更内容を要約したコミットメッセージを提案してください。
